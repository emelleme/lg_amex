/****** FILE: framework/thirdparty/javascript-templates/tmpl.js *****/

(function($){"use strict";var tmpl=function(str,data){var f=!/[^\-\w]/.test(str)?tmpl.cache[str]=tmpl.cache[str]||tmpl(tmpl.load(str)):new Function(tmpl.arg,("var _s=''"+tmpl.helper+";_s+='"+
str.replace(tmpl.regexp,tmpl.func)+"';return _s;").split("_s+='';").join(""));f.tmpl=f.tmpl||tmpl;return data?f(data):f;};tmpl.cache={};tmpl.load=function(id){return document.getElementById(id).innerHTML;};tmpl.regexp=/(\s+)|('|\\)(?![^%]*%\})|(?:\{%(=|#)(.+?)%\})|(\{%)|(%\})/g;tmpl.func=function(s,p1,p2,p3,p4,p5,p6,o,str){if(p1){return o&&o+s.length!==str.length?" ":"";}
if(p2){return"\\"+s;}
if(p3){if(p3==="="){return"'+_e("+p4+")+'";}
return"'+("+p4+"||'')+'";}
if(p5){return"';";}
if(p6){return"_s+='";}};tmpl.encReg=/[<>&"\x00]/g;tmpl.encMap={"<":"&lt;",">":"&gt;","&":"&amp;","\"":"&quot;","\x00":""};tmpl.encode=function(s){return String(s||"").replace(tmpl.encReg,function(c){return tmpl.encMap[c];});};tmpl.arg="o";tmpl.helper=",_t=arguments.callee.tmpl,_e=_t.encode"+",print=function(s,e){_s+=e&&(s||'')||_e(s);}"+",include=function(s,d){_s+=_t(s,d);}";if(typeof define==="function"&&define.amd){define("tmpl",function(){return tmpl;});}else{$.tmpl=tmpl;}}(this));
;
/****** FILE: framework/thirdparty/javascript-loadimage/load-image.js *****/

(function($){'use strict';var loadImage=function(file,callback,options){var img=document.createElement('img'),url,isFile;if(window.Blob&&file instanceof Blob){url=loadImage.createObjectURL(file);isFile=true;}else{url=file;}
img.onerror=callback;img.onload=function(){if(isFile){loadImage.revokeObjectURL(url);}
callback(loadImage.scale(img,options));};if(url){img.src=url;return img;}else{return loadImage.readFile(file,function(url){img.src=url;});}},urlAPI=(window.createObjectURL&&window)||(window.URL&&URL)||(window.webkitURL&&webkitURL);loadImage.scale=function(img,options){options=options||{};var canvas=document.createElement('canvas'),scale=Math.max((options.minWidth||img.width)/img.width,(options.minHeight||img.height)/img.height);if(scale>1){img.width=parseInt(img.width*scale,10);img.height=parseInt(img.height*scale,10);}
scale=Math.min((options.maxWidth||img.width)/img.width,(options.maxHeight||img.height)/img.height);if(scale<1){img.width=parseInt(img.width*scale,10);img.height=parseInt(img.height*scale,10);}
if(!options.canvas||!canvas.getContext){return img;}
canvas.width=img.width;canvas.height=img.height;canvas.getContext('2d').drawImage(img,0,0,img.width,img.height);return canvas;};loadImage.createObjectURL=function(file){return urlAPI?urlAPI.createObjectURL(file):false;};loadImage.revokeObjectURL=function(url){return urlAPI?urlAPI.revokeObjectURL(url):false;};loadImage.readFile=function(file,callback){if(window.FileReader&&FileReader.prototype.readAsDataURL){var fileReader=new FileReader();fileReader.onload=function(e){callback(e.target.result);};fileReader.readAsDataURL(file);return fileReader;}
return false;};if(typeof define!=='undefined'&&define.amd){define('loadImage',function(){return loadImage;});}else{$.loadImage=loadImage;}}(this));
;
/****** FILE: framework/thirdparty/jquery-fileupload/jquery.iframe-transport.js *****/

(function($){'use strict';var counter=0;$.ajaxTransport('iframe',function(options){if(options.async&&(options.type==='POST'||options.type==='GET')){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>');iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+
(counter+=1)+'"></iframe>').bind('load',function(){var fileInputClones;iframe.unbind('load').bind('load',function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild){throw new Error();}}catch(e){response=undefined;}
completeCallback(200,'success',{'iframe':response});$('<iframe src="javascript:false;"></iframe>').appendTo(form);form.remove();});form.prop('target',iframe.prop('name')).prop('action',options.url).prop('method',options.type);if(options.formData){$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop('name',field.name).val(field.value).appendTo(form);});}
if(options.fileInput&&options.fileInput.length&&options.type==='POST'){fileInputClones=options.fileInput.clone();options.fileInput.after(function(index){return fileInputClones[index];});if(options.paramName){options.fileInput.each(function(){$(this).prop('name',options.paramName);});}
form.append(options.fileInput).prop('enctype','multipart/form-data').prop('encoding','multipart/form-data');}
form.submit();if(fileInputClones&&fileInputClones.length){options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop('name',clone.prop('name'));clone.replaceWith(input);});}});form.append(iframe).appendTo(document.body);},abort:function(){if(iframe){iframe.unbind('load').prop('src','javascript'.concat(':false;'));}
if(form){form.remove();}}};}});$.ajaxSetup({converters:{'iframe text':function(iframe){return $(iframe[0].body).text();},'iframe json':function(iframe){return $.parseJSON($(iframe[0].body).text());},'iframe html':function(iframe){return $(iframe[0].body).html();},'iframe script':function(iframe){return $.globalEval($(iframe[0].body).text());}}});}(jQuery));
;
/****** FILE: framework/thirdparty/jquery-fileupload/cors/jquery.xdr-transport.js *****/

(function($){'use strict';if(window.XDomainRequest){$.ajaxTransport(function(s){if(s.crossDomain&&s.async){if(s.timeout){s.xdrTimeout=s.timeout;delete s.timeout;}
var xdr;return{send:function(headers,completeCallback){function callback(status,statusText,responses,responseHeaders){xdr.onload=xdr.onerror=xdr.ontimeout=jQuery.noop;xdr=null;completeCallback(status,statusText,responses,responseHeaders);}
xdr=new XDomainRequest();if(s.type==='DELETE'){s.url=s.url+(/\?/.test(s.url)?'&':'?')+'_method=DELETE';s.type='POST';}else if(s.type==='PUT'){s.url=s.url+(/\?/.test(s.url)?'&':'?')+'_method=PUT';s.type='POST';}
xdr.open(s.type,s.url);xdr.onload=function(){callback(200,'OK',{text:xdr.responseText},'Content-Type: '+xdr.contentType);};xdr.onerror=function(){callback(404,'Not Found');};if(s.xdrTimeout){xdr.ontimeout=function(){callback(0,'timeout');};xdr.timeout=s.xdrTimeout;}
xdr.send((s.hasContent&&s.data)||null);},abort:function(){if(xdr){xdr.onerror=jQuery.noop();xdr.abort();}}};}});}}(jQuery));
;
/****** FILE: framework/thirdparty/jquery-fileupload/jquery.fileupload.js *****/

(function($){'use strict';$.widget('blueimp.fileupload',{options:{namespace:undefined,dropZone:$(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,formData:function(form){return form.serializeArray();},add:function(e,data){data.submit();},processData:false,contentType:false,cache:false},_refreshOptionsList:['namespace','dropZone','fileInput'],_isXHRUpload:function(options){var undef='undefined';return!options.forceIframeTransport&&typeof XMLHttpRequestUpload!==undef&&typeof File!==undef&&(!options.multipart||typeof FormData!==undef);},_getFormData:function(options){var formData;if(typeof options.formData==='function'){return options.formData(options.form);}else if($.isArray(options.formData)){return options.formData;}else if(options.formData){formData=[];$.each(options.formData,function(name,value){formData.push({name:name,value:value});});return formData;}
return[];},_getTotal:function(files){var total=0;$.each(files,function(index,file){total+=file.size||1;});return total;},_onProgress:function(e,data){if(e.lengthComputable){var total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0);this._loaded+=loaded-(data.loaded||data.uploadedBytes||0);data.lengthComputable=true;data.loaded=loaded;data.total=total;this._trigger('progress',e,data);this._trigger('progressall',e,{lengthComputable:true,loaded:this._loaded,total:this._total});}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();if(xhr.upload){$(xhr.upload).bind('progress',function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable;e.loaded=oe.loaded;e.total=oe.total;that._onProgress(e,options);});options.xhr=function(){return xhr;};}},_initXHRData:function(options){var formData,file=options.files[0];if(!options.multipart||options.blob){options.headers=$.extend(options.headers,{'X-File-Name':file.name,'X-File-Type':file.type,'X-File-Size':file.size});if(!options.blob){options.contentType=file.type;options.data=file;}else if(!options.multipart){options.contentType='application/octet-stream';options.data=options.blob;}}
if(options.multipart&&typeof FormData!=='undefined'){if(options.postMessage){formData=this._getFormData(options);if(options.blob){formData.push({name:options.paramName,value:options.blob});}else{$.each(options.files,function(index,file){formData.push({name:options.paramName,value:file});});}}else{if(options.formData instanceof FormData){formData=options.formData;}else{formData=new FormData();$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value);});}
if(options.blob){formData.append(options.paramName,options.blob);}else{$.each(options.files,function(index,file){if(file instanceof Blob){formData.append(options.paramName,file);}});}}
options.data=formData;}
options.blob=null;},_initIframeSettings:function(options){options.dataType='iframe '+(options.dataType||'');options.formData=this._getFormData(options);},_initDataSettings:function(options){if(this._isXHRUpload(options)){if(!this._chunkedUpload(options,true)){if(!options.data){this._initXHRData(options);}
this._initProgressListener(options);}
if(options.postMessage){options.dataType='postmessage '+(options.dataType||'');}}else{this._initIframeSettings(options,'iframe');}},_initFormSettings:function(options){if(!options.form||!options.form.length){options.form=$(options.fileInput.prop('form'));}
if(!options.paramName){options.paramName=options.fileInput.prop('name')||'files[]';}
if(!options.url){options.url=options.form.prop('action')||location.href;}
options.type=(options.type||options.form.prop('method')||'').toUpperCase();if(options.type!=='POST'&&options.type!=='PUT'){options.type='POST';}},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);this._initFormSettings(options);this._initDataSettings(options);return options;},_enhancePromise:function(promise){promise.success=promise.done;promise.error=promise.fail;promise.complete=promise.always;return promise;},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();context=context||this.options.context||promise;if(resolveOrReject===true){dfd.resolveWith(context,args);}else if(resolveOrReject===false){dfd.rejectWith(context,args);}
promise.abort=dfd.promise;return this._enhancePromise(promise);},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;if(!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data){return false;}
if(testOnly){return true;}
if(ub>=fs){file.error='uploadedBytes';return this._getXHRPromise(false,options.context,[null,'error',file.error]);}
n=Math.ceil((fs-ub)/mcs);upload=function(i){if(!i){return that._getXHRPromise(true,options.context);}
return upload(i-=1).pipe(function(){var o=$.extend({},options);o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs);o.chunkSize=o.blob.size;that._initXHRData(o);that._initProgressListener(o);jqXHR=($.ajax(o)||that._getXHRPromise(false,o.context)).done(function(){if(!o.loaded){that._onProgress($.Event('progress',{lengthComputable:true,loaded:o.chunkSize,total:o.chunkSize}),o);}
options.uploadedBytes=o.uploadedBytes+=o.chunkSize;});return jqXHR;});};pipe=upload(n);pipe.abort=function(){return jqXHR.abort();};return this._enhancePromise(pipe);},_beforeSend:function(e,data){if(this._active===0){this._trigger('start');}
this._active+=1;this._loaded+=data.uploadedBytes||0;this._total+=this._getTotal(data.files);},_onDone:function(result,textStatus,jqXHR,options){if(!this._isXHRUpload(options)){this._onProgress($.Event('progress',{lengthComputable:true,loaded:1,total:1}),options);}
options.result=result;options.textStatus=textStatus;options.jqXHR=jqXHR;this._trigger('done',null,options);},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR;options.textStatus=textStatus;options.errorThrown=errorThrown;this._trigger('fail',null,options);if(options.recalculateProgress){this._loaded-=options.loaded||options.uploadedBytes||0;this._total-=options.total||this._getTotal(options.files);}},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1;options.textStatus=textStatus;if(jqXHRorError&&jqXHRorError.always){options.jqXHR=jqXHRorError;options.result=jqXHRorResult;}else{options.jqXHR=jqXHRorResult;options.errorThrown=jqXHRorError;}
this._trigger('always',null,options);if(this._active===0){this._trigger('stop');this._loaded=this._total=0;}},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){that._sending+=1;jqXHR=jqXHR||((resolve!==false&&that._trigger('send',e,options)!==false&&(that._chunkedUpload(options)||$.ajax(options)))||that._getXHRPromise(false,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options);}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options);}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1;that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(!nextSlot.isRejected()){nextSlot.resolve();break;}
nextSlot=that._slots.shift();}}});return jqXHR;};this._beforeSend(e,options);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){slot=$.Deferred();this._slots.push(slot);pipe=slot.pipe(send);}else{pipe=(this._sequence=this._sequence.pipe(send,send));}
pipe.abort=function(){var args=[undefined,'abort','abort'];if(!jqXHR){if(slot){slot.rejectWith(args);}
return send(false,args);}
return jqXHR.abort();};return this._enhancePromise(pipe);}
return send();},_onAdd:function(e,data){var that=this,result=true,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,fileSet,i;if(!(options.singleFileUploads||limit)||!this._isXHRUpload(options)){fileSet=[data.files];}else if(!options.singleFileUploads&&limit){fileSet=[];for(i=0;i<data.files.length;i+=limit){fileSet.push(data.files.slice(i,i+limit));}}
data.originalFiles=data.files;$.each(fileSet||data.files,function(index,element){var files=fileSet?element:[element],newData=$.extend({},data,{files:files});newData.submit=function(){newData.jqXHR=this.jqXHR=(that._trigger('submit',e,this)!==false)&&that._onSend(e,this);return this.jqXHR;};return(result=that._trigger('add',e,newData));});return result;},_normalizeFile:function(index,file){if(file.name===undefined&&file.size===undefined){file.name=file.fileName;file.size=file.fileSize;}},_replaceFileInput:function(input){var inputClone=input.clone(true);$('<form></form>').append(inputClone)[0].reset();input.after(inputClone).detach();$.cleanData(input.unbind('remove'));this.options.fileInput=this.options.fileInput.map(function(i,el){if(el===input[0]){return inputClone[0];}
return el;});if(input[0]===this.element[0]){this.element=inputClone;}},_onChange:function(e){var that=e.data.fileupload,data={files:$.each($.makeArray(e.target.files),that._normalizeFile),fileInput:$(e.target),form:$(e.target.form)};if(!data.files.length){data.files=[{name:e.target.value.replace(/^.*\\/,'')}];}
if(that.options.replaceFileInput){that._replaceFileInput(data.fileInput);}
if(that._trigger('change',e,data)===false||that._onAdd(e,data)===false){return false;}},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=(cbd&&cbd.items)||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();if(file){data.files.push(file);}});if(that._trigger('paste',e,data)===false||that._onAdd(e,data)===false){return false;}},_onDrop:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={files:$.each($.makeArray(dataTransfer&&dataTransfer.files),that._normalizeFile)};if(that._trigger('drop',e,data)===false||that._onAdd(e,data)===false){return false;}
e.preventDefault();},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger('dragover',e)===false){return false;}
if(dataTransfer){dataTransfer.dropEffect=dataTransfer.effectAllowed='copy';}
e.preventDefault();},_initEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.bind('dragover.'+ns,{fileupload:this},this._onDragOver).bind('drop.'+ns,{fileupload:this},this._onDrop).bind('paste.'+ns,{fileupload:this},this._onPaste);this.options.fileInput.bind('change.'+ns,{fileupload:this},this._onChange);},_destroyEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.unbind('dragover.'+ns,this._onDragOver).unbind('drop.'+ns,this._onDrop).unbind('paste.'+ns,this._onPaste);this.options.fileInput.unbind('change.'+ns,this._onChange);},_beforeSetOption:function(key,value){this._destroyEventHandlers();},_afterSetOption:function(key,value){var options=this.options;if(!options.fileInput){options.fileInput=$();}
if(!options.dropZone){options.dropZone=$();}
this._initEventHandlers();},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;if(refresh){this._beforeSetOption(key,value);}
$.Widget.prototype._setOption.call(this,key,value);if(refresh){this._afterSetOption(key,value);}},_create:function(){var options=this.options;options.namespace=options.namespace||this.widgetName;if(options.fileInput===undefined){options.fileInput=this.element.is('input:file')?this.element:this.element.find('input:file');}else if(!options.fileInput){options.fileInput=$();}
if(!options.dropZone){options.dropZone=$();}
this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers();},destroy:function(){this._destroyEventHandlers();$.Widget.prototype.destroy.call(this);},enable:function(){$.Widget.prototype.enable.call(this);this._initEventHandlers();},disable:function(){this._destroyEventHandlers();$.Widget.prototype.disable.call(this);},add:function(data){if(!data||this.options.disabled){return;}
data.files=$.each($.makeArray(data.files),this._normalizeFile);this._onAdd(null,data);},send:function(data){if(data&&!this.options.disabled){data.files=$.each($.makeArray(data.files),this._normalizeFile);if(data.files.length){return this._onSend(null,data);}}
return this._getXHRPromise(false,data&&data.context);}});}(jQuery));
;
/****** FILE: framework/thirdparty/jquery-fileupload/jquery.fileupload-ui.js *****/

(function($){'use strict';$.widget('blueimpUI.fileupload',$.blueimp.fileupload,{options:{autoUpload:false,maxNumberOfFiles:undefined,maxFileSize:undefined,minFileSize:0,acceptFileTypes:/.+$/i,previewFileTypes:/^image\/(gif|jpeg|png)$/,previewMaxFileSize:5000000,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:true,dataType:'json',add:function(e,data){var that=$(this).data('fileupload'),files=data.files;that._adjustMaxNumberOfFiles(-files.length);data.isAdjusted=true;data.files.valid=data.isValidated=that._validate(files);data.context=that._renderUpload(files).appendTo(that._files).data('data',data);that._reflow=that._transition&&data.context[0].offsetWidth;data.context.addClass('in');if((that.options.autoUpload||data.autoUpload)&&data.isValidated){data.submit();}},send:function(e,data){if(!data.isValidated){var that=$(this).data('fileupload');if(!data.isAdjusted){that._adjustMaxNumberOfFiles(-data.files.length);}
if(!that._validate(data.files)){return false;}}
if(data.context&&data.dataType&&data.dataType.substr(0,6)==='iframe'){data.context.find('.progressbar div').css('width',parseInt(100,10)+'%');}},done:function(e,data){var that=$(this).data('fileupload'),template,preview;if(data.context){data.context.each(function(index){var file=($.isArray(data.result)&&data.result[index])||{error:'emptyResult'};if(file.error){that._adjustMaxNumberOfFiles(1);}
that._transitionCallback($(this).removeClass('in'),function(node){template=that._renderDownload([file]);preview=node.find('.preview img, .preview canvas');if(preview.length){template.find('.preview img').prop('width',preview.prop('width')).prop('height',preview.prop('height'));}
template.replaceAll(node);that._reflow=that._transition&&template[0].offsetWidth;template.addClass('in');});});}else{template=that._renderDownload(data.result).appendTo(that._files);that._reflow=that._transition&&template[0].offsetWidth;template.addClass('in');}},fail:function(e,data){var that=$(this).data('fileupload'),template;that._adjustMaxNumberOfFiles(data.files.length);if(data.context){data.context.each(function(index){if(data.errorThrown!=='abort'){var file=data.files[index];file.error=file.error||data.errorThrown||true;that._transitionCallback($(this).removeClass('in'),function(node){template=that._renderDownload([file]).replaceAll(node);that._reflow=that._transition&&template[0].offsetWidth;template.addClass('in');});}else{that._transitionCallback($(this).removeClass('in'),function(node){node.remove();});}});}else if(data.errorThrown!=='abort'){that._adjustMaxNumberOfFiles(-data.files.length);data.context=that._renderUpload(data.files).appendTo(that._files).data('data',data);that._reflow=that._transition&&data.context[0].offsetWidth;data.context.addClass('in');}},progress:function(e,data){if(data.context){data.context.find('.progressbar div').css('width',parseInt(data.loaded/data.total*100,10)+'%');}},progressall:function(e,data){$(this).find('.fileupload-progressbar div').css('width',parseInt(data.loaded/data.total*100,10)+'%');},start:function(){$(this).find('.fileupload-progressbar').addClass('in').find('div').css('width','0%');},stop:function(){$(this).find('.fileupload-progressbar').removeClass('in').find('div').css('width','0%');},destroy:function(e,data){var that=$(this).data('fileupload');if(data.url){$.ajax(data);}
that._adjustMaxNumberOfFiles(1);that._transitionCallback(data.context.removeClass('in'),function(node){node.remove();});}},_enableDragToDesktop:function(){var link=$(this),url=link.prop('href'),name=decodeURIComponent(url.split('/').pop()).replace(/:/g,'-'),type='application/octet-stream';link.bind('dragstart',function(e){try{e.originalEvent.dataTransfer.setData('DownloadURL',[type,name,url].join(':'));}catch(err){}});},_adjustMaxNumberOfFiles:function(operand){if(typeof this.options.maxNumberOfFiles==='number'){this.options.maxNumberOfFiles+=operand;if(this.options.maxNumberOfFiles<1){this._disableFileInputButton();}else{this._enableFileInputButton();}}},_formatFileSize:function(bytes){if(typeof bytes!=='number'){return'';}
if(bytes>=1000000000){return(bytes/1000000000).toFixed(2)+' GB';}
if(bytes>=1000000){return(bytes/1000000).toFixed(2)+' MB';}
return(bytes/1000).toFixed(2)+' KB';},_hasError:function(file){if(file.error){return file.error;}
if(this.options.maxNumberOfFiles<0){return'maxNumberOfFiles';}
if(!(this.options.acceptFileTypes.test(file.type)||this.options.acceptFileTypes.test(file.name))){return'acceptFileTypes';}
if(this.options.maxFileSize&&file.size>this.options.maxFileSize){return'maxFileSize';}
if(typeof file.size==='number'&&file.size<this.options.minFileSize){return'minFileSize';}
return null;},_validate:function(files){var that=this,valid=!!files.length;$.each(files,function(index,file){file.error=that._hasError(file);if(file.error){valid=false;}});return valid;},_renderTemplate:function(func,files){return $(this.options.templateContainer).html(func({files:files,formatFileSize:this._formatFileSize,options:this.options})).children();},_renderUpload:function(files){var that=this,options=this.options,nodes=this._renderTemplate(options.uploadTemplate,files);nodes.find('.preview span').each(function(index,node){var file=files[index];if(options.previewFileTypes.test(file.type)&&(!options.previewMaxFileSize||file.size<options.previewMaxFileSize)){window.loadImage(files[index],function(img){$(node).append(img);that._reflow=that._transition&&node.offsetWidth;$(node).addClass('in');},{maxWidth:options.previewMaxWidth,maxHeight:options.previewMaxHeight,canvas:options.previewAsCanvas});}});return nodes;},_renderDownload:function(files){var nodes=this._renderTemplate(this.options.downloadTemplate,files);nodes.find('a').each(this._enableDragToDesktop);return nodes;},_startHandler:function(e){e.preventDefault();var button=$(this),tmpl=button.closest('.template-upload'),data=tmpl.data('data');if(data&&data.submit&&!data.jqXHR&&data.submit()){button.prop('disabled',true);}},_cancelHandler:function(e){e.preventDefault();var tmpl=$(this).closest('.template-upload'),data=tmpl.data('data')||{};if(!data.jqXHR){data.errorThrown='abort';e.data.fileupload._trigger('fail',e,data);}else{data.jqXHR.abort();}},_deleteHandler:function(e){e.preventDefault();var button=$(this);e.data.fileupload._trigger('destroy',e,{context:button.closest('.template-download'),url:button.attr('data-url'),type:button.attr('data-type'),dataType:e.data.fileupload.options.dataType});},_transitionCallback:function(node,callback){var that=this;if(this._transition&&node.hasClass('fade')){node.bind(this._transitionEnd,function(e){if(e.target===node[0]){node.unbind(that._transitionEnd);callback.call(that,node);}});}else{callback.call(this,node);}},_initTransitionSupport:function(){var that=this,style=(document.body||document.documentElement).style,suffix='.'+that.options.namespace;that._transition=style.transition!==undefined||style.WebkitTransition!==undefined||style.MozTransition!==undefined||style.MsTransition!==undefined||style.OTransition!==undefined;if(that._transition){that._transitionEnd=['MSTransitionEnd','webkitTransitionEnd','transitionend','oTransitionEnd'].join(suffix+' ')+suffix;}},_initButtonBarEventHandlers:function(){var fileUploadButtonBar=this.element.find('.fileupload-buttonbar'),filesList=this._files,ns=this.options.namespace;fileUploadButtonBar.find('.start').bind('click.'+ns,function(e){e.preventDefault();filesList.find('.start button').click();});fileUploadButtonBar.find('.cancel').bind('click.'+ns,function(e){e.preventDefault();filesList.find('.cancel button').click();});fileUploadButtonBar.find('.delete').bind('click.'+ns,function(e){e.preventDefault();filesList.find('.delete input:checked').siblings('button').click();});fileUploadButtonBar.find('.toggle').bind('change.'+ns,function(e){filesList.find('.delete input').prop('checked',$(this).is(':checked'));});},_destroyButtonBarEventHandlers:function(){this.element.find('.fileupload-buttonbar button').unbind('click.'+this.options.namespace);this.element.find('.fileupload-buttonbar .toggle').unbind('change.'+this.options.namespace);},_initEventHandlers:function(){$.blueimp.fileupload.prototype._initEventHandlers.call(this);var eventData={fileupload:this};this._files.delegate('.start button','click.'+this.options.namespace,eventData,this._startHandler).delegate('.cancel button','click.'+this.options.namespace,eventData,this._cancelHandler).delegate('.delete button','click.'+this.options.namespace,eventData,this._deleteHandler);this._initButtonBarEventHandlers();this._initTransitionSupport();},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers();this._files.undelegate('.start button','click.'+this.options.namespace).undelegate('.cancel button','click.'+this.options.namespace).undelegate('.delete button','click.'+this.options.namespace);$.blueimp.fileupload.prototype._destroyEventHandlers.call(this);},_enableFileInputButton:function(){this.element.find('.fileinput-button input').prop('disabled',false).parent().removeClass('disabled');},_disableFileInputButton:function(){this.element.find('.fileinput-button input').prop('disabled',true).parent().addClass('disabled');},_initTemplates:function(){this.options.templateContainer=document.createElement(this._files.prop('nodeName'));this.options.uploadTemplate=window.tmpl('template-upload');this.options.downloadTemplate=window.tmpl('template-download');},_initFiles:function(){this._files=this.element.find('.files');},_create:function(){this._initFiles();$.blueimp.fileupload.prototype._create.call(this);this._initTemplates();},destroy:function(){$.blueimp.fileupload.prototype.destroy.call(this);},enable:function(){$.blueimp.fileupload.prototype.enable.call(this);this.element.find('input, button').prop('disabled',false);this._enableFileInputButton();},disable:function(){this.element.find('input, button').prop('disabled',true);this._disableFileInputButton();$.blueimp.fileupload.prototype.disable.call(this);}});}(jQuery));
;
/****** FILE: framework/javascript/UploadField_uploadtemplate.js *****/

window.tmpl.cache['ss-uploadfield-uploadtemplate']=tmpl('{% for (var i=0, files=o.files, l=files.length, file=files[0]; i<l; file=files[++i]) { %}'+'<li class="ss-uploadfield-item template-upload{% if (file.error) { %} ui-state-error{% } %}">'+'<div class="ss-uploadfield-item-preview preview"><span></span></div>'+'<div class="ss-uploadfield-item-info">'+'<label class="ss-uploadfield-item-name">'+'<span class="name" title="{% if (file.name) { %}{%=file.name%}{% } else { %}'+ss.i18n._t('UploadField.NOFILENAME','Untitled')+'{% } %}">'+'{% if (file.name) { %}{%=file.name%}{% } else { %}'+ss.i18n._t('UploadField.NOFILENAME','Untitled')+'{% } %}</span> '+'{% if (!file.error) { %}'+'<div class="ss-uploadfield-item-status">0%</div>'+'{% } else {  %}'+'<div class="ss-uploadfield-item-status ui-state-error-text" title="{%=o.options.errorMessages[file.error] || file.error%}">{%=o.options.errorMessages[file.error] || file.error%}</div>'+'{% } %}'+'<div class="clear"><!-- --></div>'+'</label>'+'<div class="ss-uploadfield-item-actions">'+'{% if (!file.error) { %}'+'<div class="ss-uploadfield-item-progress"><div class="ss-uploadfield-item-progressbar"><div class="ss-uploadfield-item-progressbarvalue"></div></div></div>'+'{% if (!o.options.autoUpload) { %}'+'<div class="ss-uploadfield-item-start start"><button class="icon icon-16" data-icon="navigation">'+ss.i18n._t('UploadField.START','Start')+'</button></div>'+'{% } %}'+'{% } %}'+'<div class="ss-uploadfield-item-cancel cancel"><button data-icon="deleteLight" class="ss-uploadfield-item-cancel" title="'+ss.i18n._t('UploadField.CANCELREMOVE','Cancel/Remove')+'">'+ss.i18n._t('UploadField.CANCEL','Cancel')+'</button></div>'+'</div>'+'</div>'+'</li>'+'{% } %}');
;
/****** FILE: framework/javascript/UploadField_downloadtemplate.js *****/

window.tmpl.cache['ss-uploadfield-downloadtemplate']=tmpl('{% for (var i=0, files=o.files, l=files.length, file=files[0]; i<l; file=files[++i]) { %}'+'<li class="ss-uploadfield-item template-download{% if (file.error) { %} ui-state-error{% } %}" data-fileid="{%=file.id%}">'+'<div class="ss-uploadfield-item-preview preview"><span>'+'<img src="{%=file.thumbnail_url%}" alt="" />'+'</span></div>'+'<div class="ss-uploadfield-item-info">'+'<label class="ss-uploadfield-item-name">'+'<span class="name" title="{%=file.name%}">{%=file.name%}</span> '+'{% if (!file.error) { %}'+'<div class="ss-uploadfield-item-status ui-state-success-text" title="'+ss.i18n._t('UploadField.Uploaded','Uploaded')+'">'+ss.i18n._t('UploadField.Uploaded','Uploaded')+'</div>'+'{% } else {  %}'+'<div class="ss-uploadfield-item-status ui-state-error-text" title="{%=o.options.errorMessages[file.error] || file.error%}">{%=o.options.errorMessages[file.error] || file.error%}</div>'+'{% } %}'+'<div class="clear"><!-- --></div>'+'</label>'+'{% if (file.error) { %}'+'<div class="ss-uploadfield-item-actions">'+'<div class="ss-uploadfield-item-cancel ss-uploadfield-item-cancelfailed"><button class="icon icon-16">'+ss.i18n._t('UploadField.CANCEL','Cancel')+'</button></div>'+'</div>'+'{% } else { %}'+'<div class="ss-uploadfield-item-actions">{% print(file.buttons, true); %}</div>'+'{% } %}'+'</div>'+'{% if (!file.error) { %}'+'<div class="ss-uploadfield-item-editform loading"><iframe frameborder="0" src="{%=file.edit_url%}"></iframe></div>'+'{% } %}'+'</li>'+'{% } %}');
;
/****** FILE: framework/javascript/UploadField.js *****/

(function($){$.widget('blueimpUIX.fileupload',$.blueimpUI.fileupload,{_initTemplates:function(){this.options.templateContainer=document.createElement(this._files.prop('nodeName'));this.options.uploadTemplate=window.tmpl(this.options.uploadTemplateName);this.options.downloadTemplate=window.tmpl(this.options.downloadTemplateName);},_enableFileInputButton:function(){$.blueimpUI.fileupload.prototype._enableFileInputButton.call(this);this.element.find('.ss-uploadfield-addfile').show();},_disableFileInputButton:function(){$.blueimpUI.fileupload.prototype._disableFileInputButton.call(this);this.element.find('.ss-uploadfield-addfile').hide();},_onAdd:function(e,data){var result=$.blueimpUI.fileupload.prototype._onAdd.call(this,e,data);var firstNewFile=this._files.find('.ss-uploadfield-item').slice(data.files.length*-1).first();var top='+='+(firstNewFile.position().top-parseInt(firstNewFile.css('marginTop'),10)||0-parseInt(firstNewFile.css('borderTopWidth'),10)||0);firstNewFile.offsetParent().animate({scrollTop:top},1000);var fSize=0;for(var i=0;i<data.files.length;i++){if(typeof data.files[i].size==='number'){fSize=fSize+data.files[i].size;}}
$('.fileOverview .uploadStatus .details .total').text(data.files.length);if(typeof fSize==='number'&&fSize>0){fSize=this._formatFileSize(fSize);$('.fileOverview .uploadStatus .details .fileSize').text(fSize);}
if(data.files.length==1&&data.files[0].error!==null){$('.fileOverview .uploadStatus .state').text(ss.i18n._t('AssetUploadField.UploadField.UPLOADFAIL','Sorry your upload failed'));}else{$('.fileOverview .uploadStatus .state').text(ss.i18n._t('AssetUploadField.UPLOADINPROGRESS','Please wait… upload in progress'));$('.fileOverview button').hide();}
return result;},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){$.blueimpUI.fileupload.prototype._onAlways.call(this,jqXHRorResult,textStatus,jqXHRorError,options);if(this._active===0){$('.fileOverview .uploadStatus .state').text(ss.i18n._t('AssetUploadField.FILEUPLOADCOMPLETED','File Upload Completed!'));$('.fileOverview button').show();}}});$.entwine('ss',function($){$('div.ss-upload').entwine({Config:null,onmatch:function(){if(this.is('.readonly,.disabled'))return;var fileInput=this.find('input');var dropZone=this.find('.ss-uploadfield-dropzone');var config=$.parseJSON(fileInput.data('config').replace(/'/g,'"'));$(document).unbind('dragover');$(document).bind('dragover',function(e){timeout=window.dropZoneTimeout;var $target=$(e.target);if(!timeout){dropZone.addClass('active');}else{clearTimeout(timeout);}
if($target.closest('.ss-uploadfield-dropzone').length>0){dropZone.addClass('hover');}else{dropZone.removeClass('hover');}
window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;dropZone.removeClass('active hover');},100);});$(document).bind('drop dragover',function(e){e.preventDefault();});this.setConfig(config);this.fileupload($.extend(true,{formData:function(form){var idVal=$(form).find(':input[name=ID]').val();if(!idVal){idVal=0;}
return[{name:'SecurityID',value:$(form).find(':input[name=SecurityID]').val()},{name:'ID',value:idVal}];},errorMessages:{1:ss.i18n._t('UploadField.PHP_MAXFILESIZE'),2:ss.i18n._t('UploadField.HTML_MAXFILESIZE'),3:ss.i18n._t('UploadField.ONLYPARTIALUPLOADED'),4:ss.i18n._t('UploadField.NOFILEUPLOADED'),5:ss.i18n._t('UploadField.NOTMPFOLDER'),6:ss.i18n._t('UploadField.WRITEFAILED'),7:ss.i18n._t('UploadField.STOPEDBYEXTENSION'),maxFileSize:ss.i18n._t('UploadField.TOOLARGESHORT'),minFileSize:ss.i18n._t('UploadField.TOOSMALL'),acceptFileTypes:ss.i18n._t('UploadField.INVALIDEXTENSIONSHORT'),maxNumberOfFiles:ss.i18n._t('UploadField.MAXNUMBEROFFILESSHORT'),uploadedBytes:ss.i18n._t('UploadField.UPLOADEDBYTES'),emptyResult:ss.i18n._t('UploadField.EMPTYRESULT')},send:function(e,data){if(data.context&&data.dataType&&data.dataType.substr(0,6)==='iframe'){data.total=1;data.loaded=1;$(this).data('fileupload').options.progress(e,data);}},progress:function(e,data){if(data.context){var value=parseInt(data.loaded/data.total*100,10)+'%';data.context.find('.ss-uploadfield-item-status').html((data.total==1)?ss.i18n._t('UploadField.LOADING'):value);data.context.find('.ss-uploadfield-item-progressbarvalue').css('width',value);}}},config,{fileInput:fileInput,dropZone:dropZone,previewAsCanvas:false,acceptFileTypes:new RegExp(config.acceptFileTypes,'i')}));if(this.data('fileupload')._isXHRUpload({multipart:true})){$('.ss-uploadfield-item-uploador').show();dropZone.hide().show();}
this._super();},onunmatch:function(){this._super();},openSelectDialog:function(){var self=this,config=this.getConfig(),dialogId='ss-uploadfield-dialog-'+this.attr('id'),dialog=jQuery('#'+dialogId);if(!dialog.length)dialog=jQuery('<div class="ss-uploadfield-dialog" id="'+dialogId+'" />');dialog.ssdialog({iframeUrl:config['urlSelectDialog'],height:550});dialog.find('iframe').bind('load',function(e){var contents=$(this).contents(),gridField=contents.find('.ss-gridfield');contents.find('table.ss-gridfield').css('margin-top',0);contents.find('input[name=action_doAttach]').unbind('click.openSelectDialog').bind('click.openSelectDialog',function(){var ids=$.map(gridField.find('.ss-gridfield-item.ui-selected'),function(el){return $(el).data('id');});if(ids&&ids.length)self.attachFiles(ids);dialog.ssdialog('close');return false;});});dialog.ssdialog('open');},attachFiles:function(ids){var self=this,config=this.getConfig();$.post(config['urlAttach'],{'ids':ids},function(data,status,xhr){var fn=self.fileupload('option','downloadTemplate');self.find('.ss-uploadfield-files').append(fn({files:data,formatFileSize:function(bytes){if(typeof bytes!=='number')return'';if(bytes>=1000000000)return(bytes/1000000000).toFixed(2)+' GB';if(bytes>=1000000)return(bytes/1000000).toFixed(2)+' MB';return(bytes/1000).toFixed(2)+' KB';},options:self.fileupload('option')}));});}});$('div.ss-upload *').entwine({getUploadField:function(){return this.parents('div.ss-upload:first');}});$('div.ss-upload .ss-uploadfield-files .ss-uploadfield-item').entwine({onmatch:function(){this._super();this.closest('.ss-upload').find('.ss-uploadfield-addfile').addClass('borderTop');},onunmatch:function(){$('.ss-uploadfield-files:not(:has(.ss-uploadfield-item))').closest('.ss-upload').find('.ss-uploadfield-addfile').removeClass('borderTop');this._super();}});$('div.ss-upload .ss-uploadfield-startall').entwine({onclick:function(e){this.closest('.ss-upload').find('.ss-uploadfield-item-start button').click();return false;}});$('div.ss-upload .ss-uploadfield-item-cancelfailed').entwine({onclick:function(e){this.closest('.ss-uploadfield-item').remove();return false;}});$('div.ss-upload .ss-uploadfield-item-remove:not(.ui-state-disabled), .ss-uploadfield-item-delete:not(.ui-state-disabled)').entwine({onclick:function(e){var fileupload=this.closest('div.ss-upload').data('fileupload'),item=this.closest('.ss-uploadfield-item'),msg='';if(this.is('.ss-uploadfield-item-delete'))msg=ss.i18n._t('UploadField.ConfirmDelete');if(!msg||confirm(msg)){fileupload._trigger('destroy',e,{context:item,url:this.data('href'),type:'get',dataType:fileupload.options.dataType});}
return false;}});$('div.ss-upload .fileOverview .ss-uploadfield-item-edit-all').entwine({onclick:function(e){if($(this).hasClass('opened')){$('.ss-uploadfield-item .ss-uploadfield-item-edit .toggle-details-icon.opened').each(function(i){$(this).closest('.ss-uploadfield-item-edit').click();});$(this).removeClass('opened').find('.toggle-details-icon').removeClass('opened');}else{$('.ss-uploadfield-item .ss-uploadfield-item-edit .toggle-details-icon').each(function(i){if(!$(this).hasClass('opened')){$(this).closest('.ss-uploadfield-item-edit').click();}});$(this).addClass('opened').find('.toggle-details-icon').addClass('opened');}
e.preventDefault();}});$('div.ss-upload .ss-uploadfield-item-edit, div.ss-upload .ss-uploadfield-item-name').entwine({onclick:function(e){var editform=this.closest('.ss-uploadfield-item').find('.ss-uploadfield-item-editform');var disabled;var iframe=editform.find('iframe');iframe.contents().ready(function(){var iframe_jQuery=iframe.get(0).contentWindow.jQuery;iframe_jQuery(iframe_jQuery.find(':input')).bind('change',function(e){editform.removeClass('edited');editform.addClass('edited');});});if(editform.hasClass('loading')){}else{if(this.hasClass('ss-uploadfield-item-edit')){disabled=this.siblings();}else{disabled=this.find('ss-uploadfield-item-edit').siblings();}
editform.parent('.ss-uploadfield-item').removeClass('ui-state-warning');disabled.toggleClass('ui-state-disabled');editform.toggleEditForm();}
e.preventDefault();}});$('div.ss-upload .ss-uploadfield-item-editform').entwine({fitHeight:function(){var iframe=this.find('iframe'),padding=32,parentPadding=2;var h=iframe.contents().find('form').height()+padding;if(this.hasClass('includeParent')){padding=0;parentPadding=12;}
if(!$.browser.msie&&$.browser.version.slice(0,3)!="8.0"){iframe.contents().find('body').css({'height':(h-padding)});}
iframe.height(h);iframe.parent().height(h+parentPadding);iframe.contents().find('body form').css({'width':'98%'});},toggleEditForm:function(){var itemInfo=this.prev('.ss-uploadfield-item-info'),status=itemInfo.find('.ss-uploadfield-item-status');var iframe=this.find('iframe').contents(),saved=iframe.find('#Form_EditForm_error');var text="";if(this.height()===0){text=ss.i18n._t('UploadField.Editing',"Editing ...");this.fitHeight();itemInfo.find('.toggle-details-icon').addClass('opened');status.removeClass('ui-state-success-text').removeClass('ui-state-warning-text');iframe.find('#Form_EditForm_action_doEdit').click(function(){itemInfo.find('label .name').text(iframe.find('#Name input').val());});if($('div.ss-upload  .ss-uploadfield-files .ss-uploadfield-item-actions .toggle-details-icon:not(.opened)').index()<0){$('div.ss-upload .fileOverview .ss-uploadfield-item-edit-all').addClass('opened').find('.toggle-details-icon').addClass('opened');}}else{this.height(0);itemInfo.find('.toggle-details-icon').removeClass('opened');$('div.ss-upload .fileOverview .ss-uploadfield-item-edit-all').removeClass('opened').find('.toggle-details-icon').removeClass('opened');if(!this.hasClass('edited')){text=ss.i18n._t('UploadField.NOCHANGES','No Changes');status.addClass('ui-state-success-text');}else{if(saved.hasClass('good')){text=ss.i18n._t('UploadField.CHANGESSAVED','Changes Saved');this.removeClass('edited').parent('.ss-uploadfield-item').removeClass('ui-state-warning');status.addClass('ui-state-success-text');}else{text=ss.i18n._t('UploadField.UNSAVEDCHANGES','Unsaved Changes');this.parent('.ss-uploadfield-item').addClass('ui-state-warning');status.addClass('ui-state-warning-text');}}
saved.removeClass('good').hide();}
status.attr('title',text).text(text);}});$('div.ss-upload .ss-uploadfield-item-editform iframe').entwine({onmatch:function(){this.load(function(){$(this).parent().removeClass('loading');});this._super();},onunmatch:function(){this._super();}});$('div.ss-upload .ss-uploadfield-fromfiles').entwine({onclick:function(e){e.preventDefault();this.getUploadField().openSelectDialog();}});});}(jQuery));
;
